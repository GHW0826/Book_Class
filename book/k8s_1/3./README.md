
kubectl  [[link](https://kubernetes.io/ko/docs/reference/kubectl/overview/)]

### 관리형
 - EKS, AKS, GKE

### 설치형
 - 수세의 Rancher, 레드햇의 OpenShift 등 플랫폼에서 제공

### 구성형
 - kubeadm, kops, KRIB, kubespray


<details>
<summary>배포 관련 순서</summary>
<div markdown="1">
 
## 파드 배포 명령시 순서 (0 ~ 7 : 통신단계, 10번대는 순서 상관 없다).
 0. kubectl : 쿠버네티스 클러스터에 명령을 내리는 역할. 바로 실행되는 바이너리로 배포됨.
 1. API 서버 : 쿠버네티스 클러스터의 중심 통로 역할. 주로 상태 값 저장하는 etcd와 통신. 그 밖의 요소들 또한API 서버를 중심에 두고 통신.
 2. etcd: 구성 요소들의 상태 값이 모두 저장되는 곳.여기만 백업돼 있으면 긴급 장애 상황에서도 쿠버네티스 클러스터 복구 가능. key-value 저장소.
 3. 컨트롤러 매니저: 쿠버네티스 클러스터의 오브젝트 상태를 관리. 워커 노드 통신이 안되면, 상태 체크, 복구는 컨트롤러 매니저에 속한 노드 컨트롤러에서 이루어짐. 레플리카셋, 컨트롤러 매니저 포함됌.
 4. 스케줄러: 노드의 상태와 자원, 레이블,요구 조건 등을 고려해 파드를 어떤 워커 노드에 생성할지 결정, 할당. 파드를 조건에 맞는 워커 노드에 지정, 파드가 워커 노드에 할당되는 일정을 관리하는 역할.
 5. kubelet : 파드의 구성 내용(PodSpec)을 받아서 컨테이너 런타임으로 전달, 파드 안의 컨테이너들 모니터링
 6. 컨테이너 런타임 : 파드를 이루는 컨테이너의 실행을 담당.파드 안에서 다양한 종류의 컨테이너가 작동하게 만드는 표준 인터페이스.
 7. 파드 : 한 개 이상의 컨테이너로 목적의 일을 하기 위해 모인 단위. 웹서버 역할, 로그, 데이터 분석 가능. 언제든 죽을 수 있다.

 11. 네트워크 플러그인 : 쿠버네티스 클러스터의 통신을 위해서 네트워크 플러그인을 선택하고 구성. 일반적으로 CNI로 구성. (캘리코, 플래널, 실리움, 큐브 라우터, 로마나, 위브넷, Canal등이 있음)
 12. CoreDNS : 클라우드 네이티브 컴퓨팅 재단에서 보증하는 프로젝트, DNS서버이다. 쿠버네티스 클러스터에서 도메인 이름을 이용해 통신하는 데 사용. 실무에선 사용하는 것이 일반적.

## 배포된 이후 사용자가 배포된 파드에 접속하는 과정.
 1. kube-proxy : 쿠버네티스 클러스터는 파드가 위치한 노드에 kube-proxy를 통해 파트가 통신할 수 있는 네트워크 설정. 실제 통신은 br_netfilter, iptables로 관리.
 2. 파드 : 이미 배포된 파드에 접속 필요한 내용을 전달받는다. 이때 대부분 사용자는 파드가 어느 워커 노드에 위치하는지 신경 안씀.
</div>
</details>

<details>
<summary>파드 생명주기(생성, 수정, 삭제) 구성 요소</summary>
<div markdown="1">
 
## 파드 생명주기(생성, 수정, 삭제)로 쿠버네티스 구성 요소 파악
 1. kubectl을 통해 API 서버에 파드 생성을 요청
 2. (업데이트 때마다) API 서버에 전달된 내용이 있으면 API 서버는 etcd에 전달된 내용을 모두 기록해 클러스터 상태값 최신 유지.
 3. API서버에 파드 생성 요청된 것을 컨트롤러 매니저가 인지하면 매니저는 파드를 생성하고, 이 상태를 API서버에 전달. (어떤 워커 노드에 파드 적용할지 결정 x. 파드만 생성)
 4. API서버에 파드가 생성됐다는 정보를 스케줄러가 인지. 스케줄러는 생성된 파드를 어떤 워커 노드에 적용할지 조건 고려해 결정 띄우게 요청.
 5. API서버에 전달된 정보대로 지정한 워커 노드에 파드가 속해 있는지 스케줄러가 kubelet으로 확인.
 6. kubelet에서 컨테이너 런타임으로 파드 생성 요청
 7. 파드 생성
 8. 파드가 사용 가능 상태가 됌.
 
</div>
</details>


- 쿠버네티스는 작업 절차가 아니라 선언적인 시스템 구조를 가짐.
- 워커노드는 워크플로 구조에 따라 설계(순서대로 진행)

- kubectl은 꼭 마스터 노드에 위치할 필요가 없다.
- kubectl이 어디에 있더라도 API서버의 접속 정보만 있다면 어느 곳에서든 쿠버네티스 클러스터에 명령을 내릴수 있다.
- kubelet은 파드의 생성과 상태 관리 및 복구등을 담당. 문제가 생기면 파드가 정상적으로 관리되지 않는다.
- kubeproxy는 파드의 통신 담당.

- run으로 파드 생성시 단일 파드 1개만 생성되고 관리
- create deployment로 파드를 생성하면 디플로이먼트라는 관리 그룹 내에서 파드가 생성. (그룹이 추가됌)

@ 1.18 버전 이전에는 run으로 기본 파드가 디플로이먼트로 생성.

### 오브젝트
 - 파드 : 쿠버넽이스 실행 최소 단위. 웹 서비스 구동 최소 단위. 독립적인 공간, 사용 가능 IP를 가짐. 하나의 파드는 1개 이상의 컨테이너를 가짐. 여러 기능을 묶어 하나의 목적으로 사용 가능. 대부분 1개의 파드에 1개의 컨테이너 적용.
 - 네임스페이스 : 클러스터에서 사용되는 리소스들을 구분해 관리하는 그룹.
   + default : 기본 할당.
   + kube-system : 쿠버네티스 시스템에서 사용,
   + metallb-system : 온 프레미스에서 쿠버네티스 사용시 외부에서 쿠버네티스 클러스터 내부로 접속을 도와주는 컨테이너 속해있음.
 - 볼륨 : 파드 생성시 파드에서 사용할 수 있는 디렉터리 제공.임시 디렉토리도 가능. 파드 제거해도 저장, 보존 되는 디렉터리 생성도 가능.
 - 서비스 : 파드는 유동적이라 접속 정보가 고정일 수 없다. so 파드 접속을 안정적으로 유지하도록 서비스를 통해 내/외부로 연결. 파드 생성시 부여되는 IP를 기존 제공 기능에 연결한다.
  (로드밸런서, 게이트웨이와 비슷한 역할)
  
  - 디플로이먼트 : 기존 오브젝트에 추가적으로 효율적으로 작동하도록 기능들을 조합하고 추가 구현한것.
  - ex) 파드 3개시. 컨트롤러 매니저, 스케줄러가 워커 노드에 파드 3개를 만들도록 선언. but 레플리카셋은 파드 수를 보장하는 기능만 제공. 롤링 업데이트 기능 등이 추가된 디플로이먼트를 사용해 파드 수를 관리하기를 권장.

 - scale은 이미 만들어진 디플로이먼트에서만 사용 가능. 이런 설정은 오브젝트 스펙 파일에 작성. (YAML)
 - 파드의 자동 복구 기술 : 셀프 힐링. 제대로 작동하지 않는 컨테이너를 다시 시작하거나 교체해 파드가 정상적으로 작동하게 한다.
